<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wave.ripples.web.admin.mapper.IMemberMapper">
    <sql id="MemberColumns">
        a.member_id AS 'memberId',
        a.membername AS 'memberName',
        a.password,
        a.phone,
        a.email,
        a.fans,
        a.created,
        a.updated
    </sql>

    <!--根据id查询会员信息-->
    <select id="selectById" resultType="Member">
        SELECT
            <include refid="MemberColumns"></include>
        FROM
        tb_member AS a
        WHERE a.member_id = #{memberId}
    </select>

    <select id="getByLoginId" resultType="Member">
        SELECT
            <include refid="MemberColumns"></include>
        from
          tb_member AS a
        WHERE membername = #{memberName} OR phone = #{phone} OR email = #{email}
    </select>
    <!--分页查询-->
    <select id="page" resultType="Member" parameterType="Map">
        SELECT
        <include refid="MemberColumns" />
        FROM
        tb_member AS a
        <where>
            <if test="entity.memberName != null and entity.memberName !=''">
                AND a.membername LIKE CONCAT('%',#{entity.memberName},'%')
            </if>
            <if test="entity.phone != null and entity.phone !=''">
                AND a.phone LIKE CONCAT('%',#{entity.phone},'%')
            </if>
            <if test="entity.email != null and entity.email !=''">
                AND a.email LIKE CONCAT('%',#{entity.email},'%')
            </if>
        </where>
        ORDER BY updated DESC
        LIMIT #{start}, #{length}
    </select>

    <!--查询总数据数-->
    <select id="count" resultType="Integer">
        SELECT COUNT(*)
        FROM tb_member
        <where>
            <if test="memberName != null and memberName !=''">
                AND membername LIKE CONCAT('%',#{memberName},'%')
            </if>
            <if test="phone != null and phone !=''">
                AND phone LIKE CONCAT('%',#{phone},'%')
            </if>
            <if test="email != null and email !=''">
                AND email LIKE CONCAT('%',#{email},'%')
            </if>
        </where>
    </select>

    <update id="update">
        UPDATE
        tb_member
        SET
        membername = #{memberName},
        <if test="password != null and password != ''">
            password = #{password},
        </if>
        phone = #{phone},
        email = #{email},
        updated = #{updated}
        WHERE member_id = #{memberId}
    </update>

    <insert id="insert">
        INSERT INTO tb_member (
            membername,
            password,
            phone,
            email,
            created,
            updated
        )
        VALUES
        (
            #{memberName},
            #{password},
            #{phone},
            #{email},
            #{created},
            #{updated}
        );
    </insert>

    <!--通过memberId关联删除-->
    <delete id="delete">
        DELETE a,b,c FROM tb_member AS a
        LEFT JOIN tb_article AS b ON b.member_id = a.member_id
        LEFT JOIN tb_comment AS c ON c.member_id = a.member_id
        WHERE a.member_id = #{memberId};
    </delete>

    <!--批量删除-->
    <delete id="deleteMulti">
        DELETE FROM
        tb_member
        WHERE
        member_id
        IN
        <foreach collection="array" open="(" close=")" separator="," item="id">
            #{id}
        </foreach>
    </delete>

    <!--通过邮箱获取用户-->
    <select id="getEmail" resultType="Member">
        SELECT
        <include refid="MemberColumns"></include>
        FROM
        tb_member AS a
        WHERE a.email = #{email}
    </select>
</mapper>